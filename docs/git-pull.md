# リモート先の変更をローカルに反映

Git にはリモート先の変更をローカルに持ってくる機能があります。これは、共同開発時や複数の環境で作業をしている際にとても便利なものです。

## リモート先の変更をローカルにマージ (pull)

リモート先の変更をローカルに直接マージするには、リポジトリがクリーンな状態で pull コマンドを使います。(`git status` コマンドで、`nothing to commit, working tree clean` と表示される状態です。)

リモート先の変更を `git pull リモート先 リモート先のブランチ名` コマンドで反映してみましょう。
リモート先で何も変更がなければ `Already up-to-date` と表示されます。

```bash
# 現在いるブランチにマージされます
# フォーク元から取得する場合は origin を upstream に変更します
git pull origin master
```

## pull の実態

pull コマンドの実態は、リモート先の変更を取得する fetch と、ブランチを統合する merge の 2 つのコマンドの組み合わせです。取得したリモート先のブランチは、 `リモート名/リモート先のブランチ名` と表記されます。(`git branch -a` で、リモート先のブランチを確認できます。)

以下は、 fetch コマンドでリモート先の変更をローカルに取得し、それを現在いるブランチにマージする例です。

```bash
# リモート先の変更を取得
git fetch origin
# 取得した origin/master を現在いるブランチにマージ
git merge origin/master
```

## コンフリクト

::: warning
実際にコンフリクトが発生しないとできない内容です。例を用いて説明します。
:::

Git には`コンフリクト(conflict)`という状態があります。
コンフリクトとはマージする時に、変更同士が衝突する状態の事を指します。
衝突した変更に対して、Git ではどちらを保持するかの判断ができないので、
ユーザーに選択をしてもらうことになります。

<!-- 図 -->

マージした時にコンフリクトすると、以下のように出力されます。
ここでは、README.md がコンフリクトを起こしている状態となります。

```git
CONFLICT (content): Merge conflict in README.md
Automatic merge failed; fix conflicts and then commit the result.
```

`git status` で現在の状態を出力させると、今回のコンフリクトでは両方のブランチでの変更が衝突していること (`both modified`) を示してくれます。この他にも、ファイル削除に関するものもあります。(今回は割愛します)

ここからコンフリクトを解消してマージするか、マージそのものをキャンセルするかを選ぶことができます。

```git{5-7}
You have unmerged paths.
  (fix conflicts and run "git commit")
  (use "git merge --abort" to abort the merge)

Unmerged paths:
  (use "git add <file>..." to mark resolution)
        both modified:   README.md
```

::: tip マージをキャンセルするには
`git merge --abort` を実行することでキャンセルできます。
キャンセル後に `git status` を実行すると、マージする前の状態に戻っていることがわかります。
:::

## コンフリクトの解消

コンフリクトを解消するには、以下の 3 種類の方法から選ぶことになります。

- 現在のブランチの変更のみを保持する
- 他のブランチの変更のみを保持する
- 両方のブランチからの変更を組み込む

コンフリクトを起こしたファイルには、衝突を起こした箇所に衝突マーカーと呼ばれる三種類のマーカー (`<<<<<<<`, `=======`, `>>>>>>>`) が追加されています。

```{3,6,8}
# conflict test

<<<<<<< HEAD
- master ブランチでの変更 1
- master ブランチでの変更 2
=======
- hoge ブランチでの変更
>>>>>>> hoge
- 元々あったテキスト
```

衝突マーカーは

- `<<<<<<< HEAD` から `=======` まで: 現在いるブランチの変更
- `=======` から `>>>>>>> マージしようとしたブランチ名` まで: マージしようとしたブランチの変更

を示しています。**衝突マーカーと保持しない部分を消す**ことで、対応することが出来ます。例えば、現在いるブランチの変更のみを保持したい場合は以下のように編集します。

```text
# conflict test

- master ブランチでの変更 1
- master ブランチでの変更 2
- 元々あったテキスト
```

保持する内容を決めたら、保存して `git add` コマンドでファイルをステージングします。ステージングしたら、コメントを付けてコミットします。今回の場合のコメントは、「'〇〇' ブランチをマージ」のようなもので良いでしょう。

これでマージした時の衝突を解消し、作業を続けることができます。
